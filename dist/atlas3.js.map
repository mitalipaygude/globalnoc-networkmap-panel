{"version":3,"sources":["atlas3.js"],"names":["_","MetricsPanelCtrl","LeafletMap","Scale","CustomHover","panelDefaults","map_tile_url","bing_api_key","data","lat","lng","scale","zoom","choices","name","mapSrc","max","min","layers","color","mode","cardColor","colorScale","exponent","colorScheme","fillBackground","legend","show","legend_colors","tooltip","showDefault","content","invert","to_si","scales","rgb_values","hex_values","colorModes","custom_hover","tempArray","Atlas3","$scope","$injector","defaults","panel","map_holder_id","id","containerDivId","map_drawn","colorSchemes","getColorSchemes","events","on","onDataReceived","bind","onDataError","onInitEditMode","onInitPanelActions","dataList","recentData","render","process_data","self","forEach","layer","active","topology","undefined","links","target","dir","target_links","l","endpoints","ep","str","push","link","endpoint","full","bps","avg","total","interval","i","datapoints","length","value","start","end","obj","layer_max","layer_min","color_value","lineColor","getColor","az","cur","azLineColor","toSI","arrow","za","zaLineColor","update","num","toFixed","err","dataRaw","addEditorTab","displayScheme","actions","index","splice","colors","displayOpacity","htmlContent","parseHtml","scope","elem","attrs","ctrl","display","adjLoadLegend","horizontal","html_content","getHtml","find","map","containerId","networkLayer","addNetworkLayer","lineWidth","mapSource","onInitComplete","templateUrl"],"mappings":"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","file":"atlas3.js","sourcesContent":["/*\nCopyright 2018 The Trustees of Indiana University\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n\nimport './css/atlas3_leafletmap.css!';\nimport _ from 'lodash';\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport LeafletMap from './js/atlas3_leafletmap.js';\nimport {Scale} from './scale';\nimport {CustomHover} from './CustomHover';\n\nconst panelDefaults = {\n    map_tile_url: \"http://api.tiles.mapbox.com/v4/mapbox.dark/{z}/{x}/{y}.png?access_token=\",\n    bing_api_key: \"bing api key\",\n    data: [],\n    lat: 33,\n    lng: -80,\n    scale: 1,\n    zoom: 3,\n    choices: [],\n    name: [],\n    mapSrc: [],\n    max: [],\n    min: [],\n    layers: [],\n    color: {\n        mode: 'spectrum',\n        cardColor: '#b4ff00',\n        colorScale: 'linear',\n        exponent: 0.5,\n        colorScheme: 'interpolateOranges',\n        fillBackground: false\n    },\n    legend: {\n        show: true,    \n        legend_colors: []\n    },\n    tooltip:{\n        show: true,\n        showDefault: true,\n        content: ' '\n    },\n    invert:true,\n    to_si: 1000000000,\n    scales: ['linear', 'sqrt'],\n    colorScheme : 'interpolateRdYlGn',\n    rgb_values:[],\n    hex_values:[],\n    colorModes : ['opacity','spectrum'],\n    custom_hover: ' '\n};\n\nvar recentData;\nvar tempArray=[];\n\nexport class Atlas3 extends MetricsPanelCtrl {\n    constructor($scope, $injector) {\n\tsuper($scope, $injector);\n\t\n\t_.defaults(this.panel, panelDefaults);\n    this.map_holder_id = 'map_' + this.panel.id;\n    this.containerDivId = 'container_'+this.map_holder_id;\n    this.map_drawn = false;\n    this.custom_hover = new CustomHover(this.panel.tooltip.content);\n    this.scale = new Scale(this.colorScheme);\n    this.colorSchemes=this.scale.getColorSchemes();\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\n    \n    }\n    \n    \n    onDataReceived(dataList) {\n    if(!this.map_drawn){\n        recentData = dataList;\n        this.render();\n        this.map_drawn = true;\n    }\n\n    recentData = dataList;\n    this.process_data(dataList);\n    }\n    \n    process_data(dataList){\n\n    var self = this;\n\t\n\t//update with the data!\n\t_.forEach(dataList, function(data){\n\t    _.forEach(self.panel.layers, function(layer){\n\t\t//find the link associated with this data\n\n\t\tif(typeof layer.active !== \"function\"){\n\t\t    return;\n\t\t}\n\t\t\n\t\tif(layer.topology() === undefined){\n\t\t    return;\n\t\t}\n\t\t\n\t\tvar links = layer.topology().links();\n\n\t\tvar target;\n\t\tvar dir;\n\n\t\t\n\n/*\t\tif(data.target.endsWith(\"AZ\")){\n\t\t    target = data.target.substr(0,data.target.length - 3);\n\t\t    dir = \"AZ\";\n\t\t}else if(data.target.endsWith(\"ZA\")){\n\t\t    target = data.target.substr(0,data.target.length - 3);\n\t\t    dir = \"ZA\";\n\t\t}else{\n\t\t    return;\n\t\t}\n*/\n\t\t\n\t\t//var links = layer.topology().links({linkNames: [target]});\n\t\tvar target_links = [];\n\t\t_.forEach(links, function(l){\n\t\t    _.forEach(l.endpoints, function(ep){\n\t\t\tvar str = l.name + \" \" + ep;\n\t\t\tif(data.target == str){\n\t\t\t    target_links.push({link: l, endpoint: ep, full: str});\n\t\t\t}\n\t\t    });\n\t\t});\n\n\t\tvar bps;\n\n\t\tvar min;\n\t\tvar max;\n\t\tvar avg = 0;\n\t\tvar total = 0;\n\t\tvar interval;\n\n\t\t//find the last valid value\n\t\t//find the min\n\t\t//find the max\n\t\t//find the average\n\t\t//find the total datapoints\n\t\tfor (var i = (data.datapoints.length - 1); i >= 0; i--){\n\t\t    var value = data.datapoints[i][0];\n\t\t    if(value !== undefined && value !== null){\n\t\t\tavg += value;\n\t\t\ttotal += 1;\n\t\t\tif(min === undefined){\n\t\t\t    min = value;\n\t\t\t    max = value;\n\t\t\t}\n\t\t\tif(value < min){\n\t\t\t    min = value;\n\t\t\t}\n\t\t\tif(value > max){\n\t\t\t    max = value;\n\t\t\t}\n\t\t\t\n\t\t\tif(bps === undefined){\n\t\t\t    bps = value;\n\t\t\t}\n\t\t    }\n\t\t}\n\n\t\tif(total > 1){\n\t\t    var start = data.datapoints[0][1];\n\t\t    var end = data.datapoints[1][1];\n\t\t    interval = start - end;\n\t\t}\n\t\t\n\t\t_.forEach(target_links, function(obj){\n\t\t    var layer_max = layer.max();\n\t\t    var layer_min = layer.min();\n\n\t\t    var l = obj.link\n\n\t\t    var color_value = ((bps - layer_min) / (layer_max-layer_min)) * 100;\n\n\t\t    var lineColor =self.scale.getColor(color_value);//,this.panel.values);\n\t\t    \n\t\t    l.lineColor = lineColor;\n\t\t    \n\t\t    //check for AZ or ZA based on the endpoint the data was found at!\n\t\t    if(l.endpoints[0] == obj.endpoint){\n\t\t\tl.az.cur = color_value;\n\t\t\tl.azLineColor = lineColor;\n\t\t\tl.az.max = self.toSI(max);\n\t\t\tl.az.min = self.toSI(min);\n\t\t\tl.az.avg = self.toSI(avg / total);\n\t\t\tl.arrow = 1;\n\t\t    }else{\n\t\t\tl.za.cur = color_value;\n\t\t\tl.zaLineColor = lineColor;\n\t\t\tl.za.max = self.toSI(max);\n\t\t\tl.za.min = self.toSI(min);\n\t\t\tl.za.avg = self.toSI(avg / total);\n\t\t\tl.arrow = 2;\n\t\t    }\n\t\t    \n\t\t    if(l.az.cur != null && l.za.cur != null){\n\t\t\tif(l.az.cur > l.za.cur){\n\t\t\t    l.lineColor = l.azLineColor;\n\t\t\t    l.arrow = 1;\n\t\t\t}else{\n\t\t\t    l.lineColor = l.zaLineColor;\n\t\t\t    l.arrow = 2;\n\t\t\t}\n\t\t    }\n\t\t   \n\t\t});\t\n\t    });\n\t});\n\t\n\t_.forEach(this.panel.layers, function(layer){\n\t    if(typeof layer.active !== \"function\"){\n\t\t    return;\n\t    }\n\t    layer.update();\n\t});\n\t\n    }\n\n    toSI(num){\n        if(this.panel.tooltip.showDefault){\n            this.panel.to_si = panelDefaults.to_si;\n        }\n        if(this.panel.to_si <= 0){ \n            num = num / panelDefaults.to_si;\n        }\n        else{\n            num = num / this.panel.to_si;\n        }\n        return num.toFixed(2);\n    }\n    \n    onDataError(err) {\n\t    this.dataRaw = [];\n    }\n    \n    onInitEditMode() {\n\t    this.addEditorTab('Options', 'public/plugins/worldview/editor.html', 2);\n\t    this.addEditorTab('Display', 'public/plugins/worldview/display_editor.html', 3);\n\t    tempArray=this.scale.displayScheme(this.panel.colorScheme,this.panel.invert);\n    }  \n   \n    onInitPanelActions(actions) {\n\t    this.render();\n    }\n    \n    \n    addNewChoice() {\n\t    var num = this.panel.choices.length + 1;\n\t    this.panel.choices.push(num);\n\t    this.panel.name.push('');\n\t    this.panel.mapSrc.push('');\n\t    this.panel.max.push('');\n\t    this.panel.min.push('');\n    }\n    \n    removeChoice(index) {\n        this.panel.choices.splice(index,1);\n        this.panel.name.splice(index,1);\n        this.panel.mapSrc.splice(index,1);\n        this.panel.max.splice(index,1);\n        this.panel.min.splice(index,1);\n    }\n \n    display() {\n            \n        if(this.panel.color.mode==\"opacity\")\n\t\tthis.panel.colors=this.scale.displayOpacity(this.panel.color.cardColor,this.panel.invert,this.panel.color.colorScale);\n\telse\n\t\tthis.panel.colors=this.scale.displayScheme(this.panel.colorScheme,this.panel.invert);\n       \n\tthis.panel.rgb_values = this.panel.colors.rgb_values;\n        this.panel.hex_values = this.panel.colors.hex_values;\n \n   }\n  \n\n    \n    getHtml(htmlContent){\n        return this.custom_hover.parseHtml(htmlContent);\n    }\n\n    link(scope, elem, attrs, ctrl){\n\t\n\tif(ctrl.map_drawn == true){\n\t    return;\n\t}\n\t\n\tctrl.events.on('render', () => {\n\t    ctrl.display();\n            ctrl.panel.legend.legend_colors = ctrl.panel.hex_values;\n            ctrl.panel.legend.adjLoadLegend = {\n\t\thorizontal: true\n            }\n            let html_content = ctrl.getHtml(ctrl.panel.tooltip.content);\n            ctrl.panel.tooltip.content = html_content;\n            if(ctrl.map_drawn == true){\n\t      return;\n\t    }\n\t    if(!elem.find('container_map_' + ctrl.panel.id)){\n\t    }\n\t    \n        var map = LeafletMap({ containerId: 'container_map_' + ctrl.panel.id,\n            bing_api_key: ctrl.panel.bing_api_key,\n            map_tile_url: ctrl.panel.map_tile_url,\n            lat: ctrl.panel.lat,\n            lng: ctrl.panel.lng,\n            zoom: ctrl.panel.zoom,\n            tooltip: ctrl.panel.tooltip,\t\t\t\t\t\n            legend: ctrl.panel.legend\n        });\n\t    ctrl.map = map;\n\t    \n\t    if(ctrl.map === undefined){\n\t\t    return;\n\t    }\n\t    for(var i=0; i < ctrl.panel.choices.length; i++){\n\t\tif(ctrl.panel.mapSrc[i] === null || ctrl.panel.mapSrc[i] === undefined){\n\t\t    return;\n\t\t}\n\t\tvar networkLayer = map.addNetworkLayer({\n\t\t    name: ctrl.panel.name[i],\n\t\t    max: ctrl.panel.max[i],\n\t\t    min: ctrl.panel.min[i],\n\t\t    lineWidth: 3.7,\n\t\t    mapSource: ctrl.panel.mapSrc[i]\n        });\n\t\tctrl.panel.layers.push(networkLayer);\t\t\n\t\tnetworkLayer.onInitComplete(function(){\n\t\t    ctrl.process_data(recentData);\n\t\t});\n\t    }\n\t});\n\t\n    }\n    \n}\n\nAtlas3.templateUrl = 'module.html';\n"]}